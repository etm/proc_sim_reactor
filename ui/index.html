<!DOCTYPE html>
<html>
  <head>
    <title>Reactor Control</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta charset='utf-8' />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
    body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
    #chart {
      max-width: 600px;
      max-height: 400px;
    }
    </style>
  </head>
  <body>
    <h2>BPMN Extension for Real-Time Control</h2>

    <p>Business process management has focused on discrete processes so far,
    i.e., processes with identifiable distinct outcomes (e.g., manufacturing).
    By contrast, processes known from process and control engineering, e.g.,
    chemical synthesis, combustion or rectification have not been fully
    considered yet. Such processes can be discrete or continuous, i.e., require
    real-time control systems with constant inlet and outlet ï¬‚ows as well as
    temporally stable conditions. A first question is how to model continuous
    processes with existing and standardized means, i.e., BPMN, and at the same
    time to provide an exact definition of the parameters and loop conditions.
    The second question is whether and how the BPMN-based models can be
    executed, i.e., a formal execution semantic is required.</p>

    <p>This demonstrator show the capabilities of BPMN for modeling continuous
    and executalbe processes.  The graph below visualizes what is going on
    inside a reactor according to the equations of state of an ideal gas:  <strong>P*V =
    n*R*T</strong> (see  PTn in the legend of the graph, V is the constant volume, while R
    is the gas constant).</p>

    <p>The reactor is controlled by this <a
    href='https://cpee.org/flow/edit.html?monitor=https://cpee.org/flow/engine/355/'>BPMN
    process instance</a> which in turn modifies the temperature and amount of
    substance to stay within certain limits in a reactor simulation. The
    reactor simulation is implemented as a HTTP Rest service (see <a
    href='https://github.com/etm/sim_reactor'>github</a>).

    <div id="chart"></div>
    <script src="script.js"></script>
    <script>
    var lineArr = [];
    var MAX_LENGTH = 100;
    var duration = 500;
    var chart = realTimeLineChart();

    var variables = {
      p: 'Pressure (P)',
      t: 'Temperature (T)',
      n: 'Amount of substance (n)'
    };

    function randomNumberBounds(min, max) {
      return Math.floor(Math.random() * max) + min;
    }

    function seedData() {
      var now = new Date();
      var lineData = {
        time: now,
        p: 0,
        t: 0,
        n: 0
      };
      for (var i = 0; i < MAX_LENGTH; ++i) {
        lineArr.push({
          time: new Date(lineData.time - ((MAX_LENGTH - i) * duration)),
          labels: variables,
          p: lineData.p,
          t: lineData.t,
          n: lineData.n
        });
      }
    }

    function updateData() {
      var now = new Date();

      var lineData = {
        time: now,
        labels: variables,
        p: randomNumberBounds(0, 5),
        t: randomNumberBounds(0, 2.5),
        n: randomNumberBounds(0, 10)
      };
      lineArr.push(lineData);

      if (lineArr.length > 30) {
        lineArr.shift();
      }
      d3.select("#chart").datum(lineArr).call(chart);
    }

    function resize() {
      if (d3.select("#chart svg").empty()) {
        return;
      }
      chart.width(+d3.select("#chart").style("width").replace(/(px)/g, ""));
      d3.select("#chart").call(chart);
    }

    document.addEventListener("DOMContentLoaded", function() {
      seedData();
      window.setInterval(updateData, 500);
      d3.select("#chart").datum(lineArr).call(chart);
      d3.select(window).on('resize', resize);
    });
    </script>
</body>
</html>
